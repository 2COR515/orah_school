<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title id="page-title">Lesson Player ‚Äî Orah School</title>
    <!-- Dark Industrial Design System -->
    <link rel="stylesheet" href="./styles/dark-industrial.css" />
</head>
<body>
    <!-- Header -->
    <header id="page-header" class="glass sticky" style="top: 0; z-index: 1000;">
        <div class="container">
            <div class="flex items-center justify-between py-4">
                <!-- Back Button & Logo -->
                <div class="flex items-center gap-4">
                    <button id="back-btn" class="btn-ghost btn-sm">‚Üê Back</button>
                    <a href="index.html" aria-label="Orah Schools home" class="hidden md:flex items-center gap-2">
                        <img src="assets/orahlogo.png" alt="Orah Schools logo" width="50" height="33">
                        <span class="text-lg font-bold">Orah Schools</span>
                    </a>
                </div>
                
                <!-- Actions -->
                <div class="flex items-center gap-3">
                    <button id="dashboard-btn" class="btn-ghost btn-sm">Dashboard</button>
                    <!-- Theme Toggle -->
                    <button id="theme-toggle" class="btn-ghost btn-sm" style="font-size: 1.2rem; padding: 0.4rem 0.6rem;" aria-label="Toggle theme">‚òÄÔ∏è</button>
                </div>
            </div>
        </div>
    </header>

    <div class="container py-6">
        <main class="lesson-main">
            <!-- Video Section -->
            <section class="card mb-6">
                <div class="card-body p-0">
                    <video id="lesson-video" controls autoplay style="width: 100%; border-radius: var(--radius-lg); background: #000;">
                    </video>
                </div>
            </section>

            <!-- Lesson Details -->
            <section id="lesson-details" class="card mb-6">
                <div class="card-header">
                    <h1 id="lesson-title" class="lp-lesson-title text-2xl m-0">Loading Lesson...</h1>
                </div>
                <div class="card-body">
                    <h2 class="text-lg mb-2">Lesson Overview</h2>
                    <p id="lesson-description" class="lp-lesson-desc text-secondary">Fetching details and description.</p>
                </div>
            </section>

            <!-- Utility Tabs -->
            <div id="utility-tabs" class="flex gap-2 mb-4">
                <button class="tab-btn btn-ghost active" data-tab="actions">Progress & Actions</button>
                <button class="tab-btn btn-ghost" data-tab="notes">Notes</button>
                <button class="tab-btn btn-ghost" data-tab="resources">Resources</button>
            </div>

            <!-- Tab Content -->
            <div id="tab-content" class="card mb-6">
                <!-- Progress & Actions Tab -->
                <div id="tab-actions" class="tab-pane card-body">
                    <h3 class="mb-4">Progress Status</h3>
                    <div id="progress-status" class="p-4 rounded mb-4" style="background: var(--color-bg-secondary); border: 1px solid var(--color-border-primary);">
                        <p class="mb-3">Status: <strong id="progress-text" class="text-brand">Not Started</strong></p>
                        <button id="mark-completed-btn" class="btn-success">‚úì Mark as Completed</button>
                    </div>
                    
                    <h3 class="mb-4">Lesson Navigation</h3>
                    <div class="flex gap-3">
                        <button id="prev-lesson-btn" class="btn-secondary flex-1">‚Üê Previous</button>
                        <button id="next-lesson-btn" class="btn-primary flex-1">Next ‚Üí</button>
                    </div>
                </div>

                <!-- Notes Tab -->
                <div id="tab-notes" class="tab-pane card-body" style="display: none;">
                    <h3 class="mb-4">Your Study Notes</h3>
                    <textarea id="lesson-notes" placeholder="Write your notes here..." rows="10" class="mb-3"></textarea>
                    <button id="save-notes-btn" class="btn-primary">Save Notes</button>
                </div>

                <!-- Resources Tab -->
                <div id="tab-resources" class="tab-pane card-body" style="display: none;">
                    <h3 class="mb-4">Downloadable Resources</h3>
                    <ul id="resources-list" style="list-style: none; padding: 0; margin: 0;">
                        <li class="text-tertiary">No resources found.</li>
                    </ul>
                </div>
            </div>
            
            <!-- Quiz Section -->
            <section id="lesson-quiz" class="card" style="display:none;">
                <div class="card-header">
                    <h2 class="m-0">üéØ Test Your Knowledge</h2>
                </div>
                <div class="card-body">
                    <div id="quiz-questions-container" class="mb-4">
                        <p class="text-secondary">The quiz will load here once the video is complete.</p>
                    </div>

                    <div id="quiz-results" style="display:none; margin-top: 1rem;">
                    </div>

                    <button id="submit-quiz-btn" class="btn-primary">Submit Quiz</button>
                </div>
            </section>

        </main>
    </div>

    <!-- Floating Chatbot Button -->
    <button id="student-chatbot-btn" class="btn-primary" style="position: fixed; bottom: 2rem; right: 2rem; border-radius: 50%; width: 60px; height: 60px; font-size: 1.5rem; box-shadow: var(--shadow-xl), var(--glow-brand); z-index: 999;" aria-label="Open Support Chat">üí¨</button>

    <!-- Chatbot Container -->
    <div id="chatbot-container" class="card" style="position: fixed; bottom: 6rem; right: 2rem; width: 350px; max-width: calc(100vw - 4rem); height: 500px; max-height: 60vh; z-index: 1000; box-shadow: var(--shadow-xl); display: none; flex-direction: column;">
        <div class="card-header flex items-center justify-between">
            <h3 class="m-0">Orah Assistant</h3>
            <button id="chatbot-close-btn" class="btn-ghost btn-sm" style="font-size: 1.5rem; line-height: 1; padding: 0.25rem 0.5rem;">&times;</button>
        </div>
        <div id="chatbot-messages" class="card-body" style="flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 0.75rem;">
            <div style="background: var(--color-bg-secondary); padding: 0.75rem; border-radius: var(--radius-md); border: 1px solid var(--color-border-primary);">
                <strong class="text-brand">Orah Assistant:</strong>
                <p class="m-0 mt-1 text-sm">Hi! How can I help you today? You can ask me about your courses, progress, or technical issues.</p>
            </div>
        </div>
        <div class="card-footer" style="display: flex; gap: 0.5rem;">
            <input 
                type="text" 
                id="chatbot-input" 
                placeholder="Type your message..."
                autocomplete="off"
                style="flex: 1;"
            />
            <button id="chatbot-send-btn" class="btn-primary btn-sm">Send</button>
        </div>
    </div>

    <style>
        /* Chatbot Toggle Animations */
        #chatbot-container.open {
            display: flex !important;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* User and Bot Message Styles */
        .user-message, .bot-message {
            padding: 0.75rem;
            border-radius: var(--radius-md);
            border: 1px solid var(--color-border-primary);
        }

        .user-message {
            background: var(--color-brand-purple);
            color: white;
            align-self: flex-end;
            max-width: 80%;
        }

        .bot-message {
            background: var(--color-bg-secondary);
            align-self: flex-start;
            max-width: 90%;
        }

        /* Tab Button Active State */
        .tab-btn.active {
            background: var(--color-brand-purple);
            color: white;
        }
    </style>

    <!-- Theme Switcher -->
    <script src="./scripts/theme-switcher.js"></script>
    <script src="scripts/lesson-player.js"></script>
    <script src="scripts/student-chatbot.js"></script>
    
    <script>
        // Simple client-side routing handlers
        document.getElementById('back-btn').addEventListener('click', () => {
            window.history.back();
        });
        document.getElementById('dashboard-btn').addEventListener('click', () => {
            window.location.href = 'student-dashboard.html';
        });

        // Simple Tab Logic (Needs refinement in JS file, but works for basic display)
        document.querySelectorAll('.tab-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                const tabId = e.target.dataset.tab;
                
                // Remove active class from all buttons and panes
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-pane').forEach(pane => pane.style.display = 'none');

                // Add active class to the clicked button and show the corresponding pane
                e.target.classList.add('active');
                document.getElementById(`tab-${tabId}`).style.display = 'block';
            });
        });

        // Initial tab setup
        document.querySelectorAll('.tab-pane').forEach((pane, index) => {
            if (pane.id !== 'tab-actions') {
                pane.style.display = 'none';
            }
        });
        
    </script>
</body>
</html>